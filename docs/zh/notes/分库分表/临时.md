## 基本概念

当**客户端需要同时与多个局部数据库系统进行数据通信时，这时就需要有一种能够进行指令收发及数据整合的通信软件体来协助完成以上任务**。该软件体还必须能够完成与**多个数据库系统的安全访问控制、事务处理及全局查询**，在功能上等同于单个数据库里的数据库管理系统。

### 国内外产品以及问题

- 德国 GMD_IPSI 机构研发的 VIEWSYSTEM，它是一个面向对象的中间件，有自己的全局查询语言 VML，无法实现嵌套多链接的子查询，对于有些 SQL 语法不支持。 

- 加拿大阿尔伯特大学在 DIOM 项目中开发了一个基于协调器(DTC)的互操作管理体系结构的中间件，其很好的解决了查询处理功能，该查询处理模块由查询路由，动态查询执行计划器，查询结果聚合器以及查询接口管理器等构成。该中间件最大的缺点。是没有解决局部数据源的模式冲突问题。

-  IBM Almaden 研究中心研发的中间件 Carlic，它能在不改变数据源结构的前提下，为多种异构数据源提供集成视图。其最大的特点是通过建立适配器的方法来集成这些数据并提供查询功能。它最大的缺点是可扩展性不强，不能动态加载数据源。

- 东南大学研制的 Galaxy 是一个基于 CORBA 的分布式异构数据源集成系统，使用对象集成模型(OIM)作为数据集成的公共模型，对象集成查询语言(OIQL)作为其查询语言，对查询优化考虑不多。

- Sharding-JDBC

- Atlas

- MyCat

- DRDS

- Heisenberg

的有些不支持 SQL 语句嵌套查询，有些没有解决局部数据库的模式冲突问题或者没有解决事务处理问题，有些则是对查询优化考虑不多，有些则是数据源适配器的扩展性不好，有些则是自定义了第三方查询语言，对开发人员来说要求很高。

## 架构体系

### 逻辑架构

![Description](/ms-ng/cms/attach/download/61bdfc95-c731-473a-ac50-491bfd94a303/770R2yYy)

### 物理架构

![Description](/ms-ng/cms/attach/download/61bdfc95-c731-473a-ac50-491bfd94a303/nxRhNQbC)

## 主要模块

### 连接管理

### 模式处理

### 查询处理

### 数据处理

### 事务处理

### 安全控制

## 非功能需求

### 性能

### 可靠性

### 其他

## 其他方案

### Smart Client

![Description](/ms-ng/cms/attach/download/61bdfc95-c731-473a-ac50-491bfd94a303/w0m5LOXU)

业务代码需要进行一些改造，引入支持读写分离或者分库分表的功能的sdk，这个就是我们的smart-client。通常smart-client是在连接池或者driver的基础上进行了一层封装，smart-client内部与不同的库建立连接。应用程序产生的sql交给smart-client进行处理，其内部对sql进行必要的操作，例如在读写分离情况下，选择走从库还是主库；在分库分表的情况下，进行sql解析、sql改写等操作，然后路由到不同的分库，将得到的结果进行合并，返回给应用。

优点：

1. 实现简单。proxy需要实现数据库的服务端协议，但是smart-client不需要实现客户端通信协议。原因在于，大多数据数据库厂商已经针对不同的语言提供了相应的数据库驱动driver，例如mysql针对java语言提供了mysql-connector-java驱动，针对python提供了mysql-connector-python驱动，客户端的通信协议已经在driver层面做过了。因此smart-client模式的中间件，通常只需要在此基础上进行封装即可。

2. 天然去中心化。smart-client的方式，由于本身以sdk的方式，被应用直接引入，随着应用部署到不同的节点上，且直连数据库，中间不需要有代理层。因此相较于proxy而言，除了网络资源之外，基本上不存在任何其他资源的竞争，也不需要考虑高可用的问题。只要应用的节点没有全部宕机，就可以访问数据库。(这里的高可用是相比proxy而言，数据库本身的高可用还是需要保证的)

缺点：

1. 通常仅支持某一种语言。例如tddl、zebra、sharding-jdbc都是使用java语言开发，因此对于使用其他语言的用户，就无法使用这些中间件。如果其他语言要使用，那么就要开发多语言客户端。

2. 版本升级困难。因为应用使用数据源代理就是引入一个jar包的依赖，在有多个应用都对某个版本的jar包产生依赖时，一旦这个版本有bug，所有的应用都需要升级。而数据库代理升级则相对容易，因为服务是单独部署的，只要升级这个代理服务器，所有连接到这个代理的应用自然也就相当于都升级了。

### ORM







